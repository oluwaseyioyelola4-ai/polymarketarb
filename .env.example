# =============================
# polymarketarb .env.example
# =============================
# Copy this file to `.env` and fill in values.
# Never commit real secrets.
#
# cp .env.example .env

# --- Network / Wallet ---
# Polygon RPC URL
RPC_URL=https://polygon-rpc.com

# Polygon EOA private key (required for LIVE_TRADING)
# PRIVATE_KEY=0x...

# --- Mode / Safety Gates ---
# Paper mode by default.
# Set LIVE_TRADING=true to enable live mode (requires PRIVATE_KEY + CLOB_API_*).
LIVE_TRADING=false

# Extra safety gate: even in live mode, orders will NOT be placed unless this is true.
ENABLE_LIVE_ORDERS=false

# Initial balance for paper trading (default: $1.00)
# For live trading, deposit actual funds using: node setup-wallet.js deposit <amount>
INITIAL_BALANCE=1.0

# Optional: informational estimate (USD) per on-chain transaction (approve/deposit/withdraw/claim).
# CLOB orders themselves are off-chain; this is just for dashboard awareness.
# EST_ONCHAIN_TX_USD=0.10

# Strategy mode:
# - arbitrage: buys both sides when combined cost < $1 (equal-profit straddle)
# - lag: directional trades when Polymarket lags RTDS spot moves
# - certainty: mode 3 (resolution trading / stop-loss + rebuy simulation)
BOT_MODE=arbitrage

# RTDS feed source:
# If you want ONE feed ("most correct" / canonical oracle), use Chainlink:
# - chainlink: Chainlink BTC/USD oracle on Polygon (slower, on-chain)
#
# Other options:
# - binance_ws: Binance WebSocket trades (BTCUSDT) (fast RTDS proxy)
# - auto: use Binance when fresh, otherwise fall back to Chainlink
RTDS_SOURCE=auto

# Optional: override the Chainlink BTC/USD feed address (Polygon).
# CHAINLINK_BTC_USD_FEED=0xc907E116054Ad103354f2D350FD2514433D57F6f

# --- Market selection ---
# 15m BTC Up/Down series slug prefix.
SERIES_SLUG_PREFIX=btc-updown-15m-

# --- Polling cadences (ms) ---
UNDERLYING_POLL_MS=1000
MARKET_REFRESH_MS=2000
ORDERBOOK_POLL_MS=100
QUOTE_POLL_MS=1000
DASHBOARD_MS=500

# Live balance polling
BALANCE_POLL_MS=10000

# --- Arbitrage / Straddle settings ---
# Minimum USDC to use per straddle attempt
STRADDLE_MIN_USDC=5

# Maximum USDC to use per straddle attempt
STRADDLE_MAX_USDC=10

# Minimum guaranteed profit (per outcome) required to trade
STRADDLE_MIN_PROFIT_CENTS=0.25

# Cooldown between straddle attempts (paper + live)
STRADDLE_COOLDOWN_MS=2500

# Minimum shares per side
STRADDLE_MIN_SHARES=1

# --- Lag mode settings ---
# Minimum / maximum USDC to spend per lag trade
LAG_MIN_USDC=5
LAG_MAX_USDC=10

# Minimum spot move (USD) to consider a lag signal
LAG_SPOT_MOVE_USD=25

# Lag entry model (prevents "mindless" buys)
# The bot now gates entries using BOTH:
# - fast/slow RTDS momentum (seconds vs ~30s)
# - orderbook microstructure (spread + imbalance + microprice)
#
# Models:
# - basic: legacy behavior (spot move vs market move)
# - micro: microstructure + fast/slow RTDS (recommended)
LAG_ENTRY_MODEL=micro

# RTDS horizons used by LAG_ENTRY_MODEL=micro
# fast ~ 1-2 seconds proxy, slow ~ 30 seconds baseline
LAG_FAST_SEC=2
LAG_SLOW_SEC=30
LAG_HISTORY_SEC=120

# Entry gating thresholds
LAG_EDGE_MIN_CENTS=0.25
LAG_MAX_SPREAD_CENTS=3.0
LAG_IMBALANCE_MIN=0.05
LAG_IMBALANCE_LEVELS=5

# Binance volume + price-action indicators (used to refine entries when Binance WS is available)
# These are soft factors by default: they adjust the required edge rather than hard-blocking.
LAG_USE_BINANCE_FLOW=true
LAG_FLOW_WINDOW_SEC=10
LAG_FLOW_BASELINE_SEC=60
LAG_FLOW_MIN_RATIO=1.10
LAG_FLOW_IMBALANCE_MIN=0.05
LAG_FLOW_WEAK_EXTRA_EDGE_CENTS=0
LAG_FLOW_AGAINST_EXTRA_EDGE_CENTS=0.25
LAG_FLOW_BONUS_EDGE_CENTS=0.15

# Lightweight online learning ("AI")
# Learns a small local linear model from recent Binance flow + price action + orderbook microstructure.
# No external LLM calls.
LAG_AI_ENABLE=true
LAG_AI_LEARN=true
LAG_AI_MIN_SAMPLES=30
LAG_AI_LR=0.02
LAG_AI_L2=0.002
LAG_AI_MAX_ABS_W=5.0
LAG_AI_BLEND=0.5

# Spike handling (fast move >= this triggers stricter gating)
LAG_SPIKE_USD=80
LAG_SPIKE_EXTRA_EDGE_CENTS=0.5

# Optional penalties (defaults to 0). Set these > 0 if you want the bot to be more conservative
# under weak/against orderbook pressure or when a spike disagrees with the slow horizon.
LAG_WEAK_PRESSURE_EXTRA_EDGE_CENTS=0
LAG_AGAINST_PRESSURE_EXTRA_EDGE_CENTS=0
LAG_SPIKE_DISAGREE_EXTRA_EDGE_CENTS=0

# Accuracy / robustness (uses all available internal data)
# Skip lag entries if Binance vs Chainlink disagree too much (spot uncertainty)
LAG_FEED_DISAGREE_USD=20

# Only hard-block entries when the divergence is extreme
LAG_FEED_DISAGREE_USD_HARD=150

# Feed freshness windows for the disagreement check
# Binance WS is near-real-time; Chainlink is slower on purpose.
LAG_BINANCE_MAX_AGE_MS=5000
LAG_CHAINLINK_MAX_AGE_MS=180000

# Learn an online mapping from BTC move (USD) -> token move (cents)
# (Uses recent observed market response to improve signal accuracy)
LAG_CALIBRATE=true
LAG_CALIBRATE_ALPHA=0.15
LAG_CALIBRATE_MIN_SAMPLES=8
LAG_CALIBRATE_MIN_CENTS_PER_USD=0.005
LAG_CALIBRATE_MAX_CENTS_PER_USD=0.25

# Require the lag signal to persist for N orderbook ticks before entering
LAG_ENTRY_CONFIRM_TICKS=2

# USD->cents mapping used for entry edge prediction (defaults to LAG_TP_CENTS_PER_USD)
# LAG_MODEL_CENTS_PER_USD=0.05

# Minimum Polymarket move required to consider the market as having "responded"
# (probability points; 0.005 = 0.5Â¢). If market moves >= this, lag baseline resets.
LAG_MIN_MARKET_MOVE=0.005

# Take-profit target for lag exits.
# Modes:
# - fixed: use LAG_TAKE_PROFIT_CENTS
# - percent: use LAG_TAKE_PROFIT_PCT (fraction of entry)
# - dynamic: scale TP from forecasted lag (default)
LAG_TAKE_PROFIT_MODE=dynamic

# Hard minimum profit per share (cents) across ALL TP modes
LAG_MIN_PROFIT_CENTS=1.0

# Fixed cents per share:
LAG_TAKE_PROFIT_CENTS=1.0

# Percent of entry (0.03 = 3%):
# LAG_TAKE_PROFIT_PCT=0.03

# Dynamic TP tuning (used when LAG_TAKE_PROFIT_MODE=dynamic):
# targetCents ~= clamp(min,max, |spotDeltaUsd|*centsPerUsd - marketMoveCents)
LAG_TP_MIN_CENTS=1.0
LAG_TP_MAX_CENTS=10.0
LAG_TP_CENTS_PER_USD=0.05

# Stop-loss (lag mode)
# - percent: classic stop by fraction of entry
# - dynamic: stop based on forecasted lag/TP
# - strict: use BOTH and pick the stricter stop (default)
LAG_STOP_LOSS_MODE=strict
LAG_STOP_LOSS_PCT=0.01

# Dynamic stop tuning (used in dynamic/strict):
# allowedLossCents = clamp(min,max, desiredProfitCents * riskFrac)
LAG_SL_MIN_CENTS=1.0
LAG_SL_MAX_CENTS=3.0
LAG_SL_RISK_FRAC=0.5

# Stop-loss noise guards (reduce whipsaw stop-outs)
LAG_STOP_GRACE_MS=3000
LAG_STOP_CONFIRM_TICKS=2

# Risk controls (lag mode)
# Cap worst-case loss per trade (approx, fee-aware).
LAG_MAX_RISK_USDC=0.5

# Optional: override risk cap as a fraction of balance (e.g. 0.02 = 2%).
# LAG_RISK_PCT_BALANCE=0.02

# Minimum risk/reward ratio required (TP cents >= RR * stop-loss cents)
LAG_MIN_RR=1.5

# Cooldown after a stop-out (prevents immediate re-entry chop)
LAG_STOP_COOLDOWN_MS=15000

# Cooldown between lag trades
LAG_COOLDOWN_MS=2500

# --- Mode 3 (BOT_MODE=certainty): Resolution trading simulation ---
# Implements your rules:
# - Buy when bestAsk <= 0.80 AND time-to-resolution < 10 minutes.
# - Stop-loss: attempt sell with a 0.75 LIMIT (FOK-style sweep simulation).
# - Rebuy (only after stop-loss): if either side is available at <= 0.75, rebuy (any direction).
# - Otherwise hold until resolution (paper settlement uses Gamma resolved outcome).
#
# Fees:
# - Uses the token-specific fee rate returned by Polymarket CLOB (see dashboard / state.tokens.*FeeBps).
# - Paper simulation applies the same notional fee model used elsewhere in this repo:
#   buyCost = notional * (1 + feeBps/10000)
#   sellProceeds = gross * (1 - feeBps/10000)
#
# Gas:
# - CLOB orders are off-chain; default per-order gas is 0.
# - Settlement/claim gas is optional and default is 0 (set if you want to model it).

# Entry / stop / rebuy
RES_ENTRY_MAX_TTR_SEC=600
RES_ENTRY_MAX_PRICE=0.80
RES_STOP_PRICE=0.75
RES_REBUY_MAX_PRICE=0.75

# Liquidity protection
RES_MAX_SPREAD=0.02
RES_MIN_SHARES=1

# Simulation knobs
RES_ORDER_GAS_USDC=0
RES_GAS_SETTLE_USDC=0
RES_COOLDOWN_MS=1000
RES_CONFIRM_TICKS=1
RES_PRICE_EPS=0.000001

# --- Polymarket CLOB L2 credentials (required for placing/canceling orders) ---
# You must generate these from Polymarket / CLOB.
# CLOB_API_KEY=
# CLOB_API_SECRET=
# CLOB_API_PASSPHRASE=

# --- Polymarket Builder API credentials (optional) ---
# If provided, the bot will attach builder headers to order POSTs.
# BUILDER_API_KEY=
# BUILDER_API_SECRET=
# BUILDER_API_PASSPHRASE=
